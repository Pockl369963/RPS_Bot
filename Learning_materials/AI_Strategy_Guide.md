# AI戦略ガイド (3.4 Meta Strategy)

個別の予測器の実装が終わりました。
**Meta Strategy (Strategy Selector)** は、これらの予測器を統括し、「どの予測器を信じるべきか」を動的に判断します。

---

## 1. コンセプト: 予測器の予測器

単一の予測器（例: Markov）だけを使うと、ユーザーにその特性を見抜かれた瞬間に負け始めます。
Selectorは、複数の「戦略」を仮想的に戦わせ、最も成績の良い戦略を採用します。

### 戦略の種類
各予測器（Predictor）に対して、2つの派生戦略を持ちます。

1.  **P0 (Naive)**: 予測器が「ユーザーはRを出す」と言ったら、「P」を出す。（素直な勝ち手）
2.  **P1 (Second-guess)**: ユーザーが「AIはP（P0の手）を出してくる」と読んで「S」を出してくると仮定し、その裏をかいて「R」を出す。（裏の裏）

つまり、4つの予測器があれば、合計 8つの戦略 (4 x 2) が常に競い合います。

---

## 2. 実装詳細

### スコアリングシステム
`StrategySelector` クラスは `scores` 辞書を持ちます。
毎ラウンド終了時に `update_scores(user_move)` が呼ばれ、もしその戦略を採用していたら勝っていたか？を判定します。

*   **Win**: +1点
*   **Lose**: -1点
*   **Draw**: 0点

### 意思決定 (Select Move)
1.  全予測器を実行し、それぞれ予測値を得る。
2.  各予測値から、P0（勝ち手）とP1（裏の裏）を計算する。
3.  現在の `scores` が最も高い戦略の手を採用する。

---

## 3. コードのポイント

```python
# StrategySelector.select_move
best_strategy = max(self.scores, key=self.scores.get)
return strategy_moves[best_strategy]
```

このように、非常にシンプルなロジックで「その時その時で最強の戦略」に乗り換えることができます。
これを **"Iocaine Powder" 戦略** と呼びます（映画『プリンセス・ブライド』の毒当てゲームに由来）。

---

次は最後の仕上げ、AIの暴走やハメ技を防ぐ「安全策 (Safety Mechanisms)」の実装です。
